{
  "updatedAt": "2025-11-20T02:03:39.000Z",
  "createdAt": "2025-10-27T18:19:48.833Z",
  "id": "ekNtCLOwi49Vywr9",
  "name": "Doist Summary",
  "description": null,
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -3376,
        96
      ],
      "id": "3d5b5048-1cb9-411c-8d48-08b7fc9bfc43",
      "name": "When clicking ‚ÄòExecute workflow‚Äô"
    },
    {
      "parameters": {
        "url": "={{ $json.twist_api }}/conversations/get_unread",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "twistOAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "workspace_id",
              "value": "={{ $json.workspace_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2928,
        96
      ],
      "id": "0cd5fead-d5a0-4620-bc97-23a0f1481087",
      "name": "Get Unread Conversations",
      "alwaysOutputData": true,
      "credentials": {
        "twistOAuth2Api": {
          "id": "11",
          "name": "Twist account"
        }
      }
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"workspace_id\": \"1585\",\n  \"twist_api\": \"https://api.twist.com/api/v3\",\n  \"whois\": \"Gon√ßalo\",\n  \"todoist_filter\": \"(today | (@work & @next)) & (assigned to: me | !assigned)\",\n  \"conversation_id\": \"146676\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3152,
        96
      ],
      "id": "e408555b-051f-4d45-9c52-847e83a8e59a",
      "name": "Variables"
    },
    {
      "parameters": {
        "url": "={{ $json.twist_api }}/threads/get_unread",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "twistOAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "workspace_id",
              "value": "={{ $json.workspace_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2928,
        320
      ],
      "id": "9591d794-dd48-41d8-a46c-5fbc4cc941e3",
      "name": "Get Unread threads",
      "alwaysOutputData": true,
      "credentials": {
        "twistOAuth2Api": {
          "id": "11",
          "name": "Twist account"
        }
      }
    },
    {
      "parameters": {
        "url": "https://api.twist.com/api/v3/comments/get",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "twistOAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "thread_id",
              "value": "={{ $json.thread_id }}"
            },
            {
              "name": "from_obj_index",
              "value": "={{ $json.obj_index }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2496,
        320
      ],
      "id": "e9d67044-1b64-48aa-b097-cbe35939f704",
      "name": "Get Thread Comments",
      "credentials": {
        "twistOAuth2Api": {
          "id": "11",
          "name": "Twist account"
        }
      }
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "aggregation": "append",
              "field": "thread"
            }
          ]
        },
        "fieldsToSplitBy": "thread_id",
        "options": {}
      },
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1.1,
      "position": [
        -1840,
        320
      ],
      "id": "57c3e85f-ed29-413a-bbf8-d83d79995a4c",
      "name": "Group By Thread Id"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8483259c-3da4-478e-af36-5a9bad78c187",
              "name": "thread_id",
              "value": "={{ $json.thread_id }}",
              "type": "string"
            },
            {
              "id": "992fcbc3-ed6d-40f0-9c0d-da55d6baff87",
              "name": "thread.channel_id",
              "value": "={{ $json.channel_id }}",
              "type": "number"
            },
            {
              "id": "b50a73e2-c18d-44d1-9964-a1d7600d5321",
              "name": "thread.thread_id",
              "value": "={{ $json.thread_id }}",
              "type": "number"
            },
            {
              "id": "b48bc2f5-03c0-49a0-b0ef-339cd0852b01",
              "name": "thread.content",
              "value": "={{ $json.content }}",
              "type": "string"
            },
            {
              "id": "a89aaa95-e8d2-4cf0-bf6c-8444b65dd490",
              "name": "thread.creator_name",
              "value": "={{ $json.creator_name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2064,
        320
      ],
      "id": "a3f48268-8fd1-4f9d-ae6a-594e069e7c07",
      "name": "Store Thread"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "operation": "getAll",
        "filters": {
          "filter": "={{ $json.todoist_filter }}"
        }
      },
      "type": "n8n-nodes-base.todoist",
      "typeVersion": 2.1,
      "position": [
        -2928,
        -128
      ],
      "id": "b279abcb-c767-4b2c-809f-00e8363ac5d7",
      "name": "Today's tasks",
      "credentials": {
        "todoistOAuth2Api": {
          "id": "6",
          "name": "Todoist account"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ $('Variables').item.json.twist_api }}/conversation_messages/get",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "twistOAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "conversation_id",
              "value": "={{ $json.conversation_id }}"
            },
            {
              "name": "from_obj_index",
              "value": "={{ $json.obj_index }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2496,
        96
      ],
      "id": "50776a48-7ffc-474e-a4a3-cbffeb2aa8a5",
      "name": "Get All Messages",
      "credentials": {
        "twistOAuth2Api": {
          "id": "11",
          "name": "Twist account"
        }
      }
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "aggregation": "append",
              "field": "conversation"
            }
          ]
        },
        "fieldsToSplitBy": "conversation_id",
        "options": {}
      },
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1.1,
      "position": [
        -1840,
        96
      ],
      "id": "9a34d702-4aac-454a-b794-6e7e657cde27",
      "name": "Group By Conversation Id"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "b46f84c9-3686-42ca-8d06-a446ad6b741c",
              "leftValue": "={{ $json.deleted }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        -2288,
        96
      ],
      "id": "783c0e48-7cc7-4804-8154-a3d24705dd85",
      "name": "Filter: Deleted Messages"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -1456,
        576
      ],
      "id": "44958a0e-447d-4441-864d-1c2b23329bd2",
      "name": "Gemini 2.5 Flash",
      "credentials": {
        "googlePalmApi": {
          "id": "pghrD0vRol1swXjM",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ JSON.stringify($json) }}",
        "options": {
          "systemMessage": "You are an assistant that produces a daily digest from a JSON input containing:\n\t‚Ä¢\ttasks[] (Todoist-style): fields include content, priority (1‚Äì4), due (object with date YYYY-MM-DD and possibly recurring string like ‚Äúevery workday‚Äù, ‚Äúevery monday‚Äù), url.\n\t‚Ä¢\tconversations[] (DMs): each has conversation_url, and output with type_primary, summary, importance (0‚Äì5), density, needs_response (bool).\n\t‚Ä¢\tthreads[]: each has url, and output with the same shape as conversations.\n\nObjective\n\nCreate a single daily digest that:\n\t‚Ä¢\tIncludes every item (do not omit anything).\n\t‚Ä¢\tGroups related items so they can be tackled together.\n\t‚Ä¢\tOrders groups by the most urgent/important item within each group.\n\t‚Ä¢\tUses a sectioned format with emoji headings.\n\t‚Ä¢\tShows minimal hints only: due labels (e.g., ‚ÄúDue today‚Äù, ‚ÄúDue Mon 27 Oct‚Äù) and ‚ÄúNeeds reply‚Äù for response-required items.\n\nTime and date rules\n\t‚Ä¢\t‚ÄúToday‚Äù is the current calendar day in your local timezone.\n\t‚Ä¢\tIf a task is recurring every workday, treat it as today on Mon‚ÄìFri.\n\t‚Ä¢\tIf a task recurs ‚Äúevery monday‚Äù, consider the next Monday after today.\n\t‚Ä¢\tIf an item has both a ‚Äúdate‚Äù and a ‚Äúdue‚Äù, use whichever is closer to today for urgency and labeling.\n\nRanking model (0‚Äì100 ‚Äúattention score‚Äù)\n\nCompute an item score; the group score is the maximum of its items.\n\nThreads & DMs\n\t‚Ä¢\timportance (0‚Äì5) √ó 4\n\t‚Ä¢\tneeds_response true ‚Üí +10\n\nTasks\n\t‚Ä¢\tpriority (1‚Äì4) √ó 3\n\t‚Ä¢\tDate proximity:\n\t‚Ä¢\t+12 if overdue\n\t‚Ä¢\t+8 if due today\n\t‚Ä¢\t+6 if due tomorrow\n\t‚Ä¢\t+4 if due within 3 days\n\t‚Ä¢\t+0 otherwise\n\nDensity is not used for ranking; it‚Äôs only a hint (do not display unless asked).\n\nTiebreakers (in order):\nneeds_response ‚Üí nearer due/date ‚Üí higher importance/priority ‚Üí more recent update (if available).\n\nGrouping rules\n\nGroup items when any of these hold:\n\t‚Ä¢\tSame project / channel / thread / conversation IDs.\n\t‚Ä¢\tShared keywords in titles/summaries.\n\t‚Ä¢\tShared labels/tags (if present).\n\t‚Ä¢\tHigh fuzzy text similarity.\n\nGroup title: derive from the best shared context (project, topic noun phrase, or concise theme).\n\nOutput format\n\nProduce only the digest in Markdown. Use these sections if they contain items:\n\nüö® Overdue & Urgent\n\t‚Ä¢\tGroups whose top item is an overdue or due-today task.\n\nüì® Needs Response\n\t‚Ä¢\tGroups whose top item has needs_response: true. (Groups may include related items that don‚Äôt need a reply‚Äîkeep them with the group.)\n\n‚è∞ Today / Tomorrow\n\t‚Ä¢\tGroups whose top item has a task due tomorrow, or any item in the group has a task due within 3 days and none qualify above.\n\nüí¨ Active & Informational\n\t‚Ä¢\tGroups consisting primarily of threads/DMs with no immediate due pressure.\n\nüìÖ Upcoming & Low Priority\n\t‚Ä¢\tEverything else.\n\nWithin each group:\n\t‚Ä¢\tStart with a bold group title on one line.\n\t‚Ä¢\tThen list items in descending score:\n\t‚Ä¢\t- [Title or concise summary](URL) ‚Äî <label>\n\t‚Ä¢\tLabels are only: Due today, Due Tue 28 Oct, Needs reply, Overdue.\n\t‚Ä¢\tKeep tone friendly but succinct; emoji are okay in headings, not in item lines.\n\nConstraints\n\t‚Ä¢\tDo not omit items.\n\t‚Ä¢\tKeep the digest informational and to the point.\n\t‚Ä¢\tUse Markdown links for every item‚Äôs URL.\n\t‚Ä¢\tNo extra commentary before or after the digest.\n\nExample call\n\t‚Ä¢\tInput: a JSON object with tasks, conversations, threads arrays.\n\t‚Ä¢\tOutput: the sectioned Markdown digest as specified above."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -368,
        128
      ],
      "id": "26dbe341-17b9-4806-9112-3561fe74545e",
      "name": "PAIST Planner"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-pro",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -368,
        336
      ],
      "id": "25cfd8c0-f59f-44ff-b125-4e66e2681d24",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "pghrD0vRol1swXjM",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "tasks",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -848,
        -128
      ],
      "id": "2b77756e-d08e-43fa-85b6-a6863eee4090",
      "name": "Combine all tasks"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "812ed34a-8528-4f26-adf6-89b1a57066d5",
              "name": "conversation_id",
              "value": "={{ $json.conversation_id }}",
              "type": "string"
            },
            {
              "id": "b8b4aa83-cfc1-4118-bc06-e0d5172c2106",
              "name": "conversation.conversation_id",
              "value": "={{ $json.conversation_id }}",
              "type": "number"
            },
            {
              "id": "80f764eb-72d8-422f-8dc1-286bbcb8a219",
              "name": "conversation.content",
              "value": "={{ $json.content }}",
              "type": "string"
            },
            {
              "id": "4bd5d099-e337-4d5a-8b50-fe561647c756",
              "name": "conversation.creator_name",
              "value": "={{ $json.creator_name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2064,
        96
      ],
      "id": "a9aab5ae-c57c-4a60-a023-ed032b956e0b",
      "name": "Store Messages"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "5fecaf3e-0e3a-4d9d-8c50-7fd7aec1a23b",
              "leftValue": "={{ $json.deleted }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        -2288,
        320
      ],
      "id": "3417f7ef-9e3d-44e8-b503-90e61bed6ae3",
      "name": "Filter Deleted Threads"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Process the following conversations and return results in valid JSON only, one object per conversation, preserving input order. Do not invent fields or content. Use the schema from the system prompt.\n\nUSER_CONTEXT:\n- user name: \"{{ $('Variables').item.json.whois }}\"\"\n- now_iso: \"{{ $json.now ?? $now }}\"  // optional; helps density/recency if you use timestamps\n\nINPUT:\n\n{{ JSON.stringify($json) }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=You are an intelligent personal assistant whose goal is to help the user stay organised, reduce noise, and focus on the most meaningful conversations.\n\nYou will read message threads, understand their intent, and produce a structured summary in **valid JSON** only ‚Äî no extra text.\n\n---\n\n### Process\n1. **Understand the conversation**\n   - Read all messages.\n   - Identify the main topic, purpose, and outcome.\n   - Note whether the user was asked to act.\n\n2. **Classify the thread**\n   - Use one primary and optional secondary type:\n     [\"project\", \"informational\", \"request\", \"issue\", \"social\", \"other\"]\n\n3. **Score importance (0‚Äì5)**\n   - Base score:\n     request=3, issue=3, project=2, informational=1, social=0, other=1\n   - Add +2 if user is mentioned directly (cap 5)\n   - Add +1 if urgent, decision-critical, or blocking (cap 5)\n\n4. **Score density (0‚Äì5)**\n   - 0‚Äì2 = few/short/casual comments  \n   - 3‚Äì4 = moderate thread with substance  \n   - 5 = large, detailed, or decision-heavy thread\n\n5. **Summarise**\n   - One short, factual paragraph (‚â§ 60 words)\n   - Describe what happened, main topic, and any clear outcome.\n\n6. **Response logic**\n   - `needs_response` = true if:\n     - the comment implies a question, action, or unresolved decision.\n   - If true, include a short, imperative `response_hint`\n     (start with a verb, e.g. ‚ÄúAcknowledge‚Ä¶‚Äù, ‚ÄúClarify‚Ä¶‚Äù, ‚ÄúShare feedback‚Ä¶‚Äù).\n\n---\n\n### Output format\nReturn only JSON (no text before/after):\n{\n  \"type_primary\": \"string\",\n  \"importance\": 0,\n  \"density\": 0,\n  \"summary\": \"string\",\n  \"needs_response\": true,\n  \"response_hint\": \"string\"\n}\n\nIf `needs_response` = false, omit `response_hint`.\n\n---\n\n### Example input\n{\n  \"conversation_id\": 7339181,\n  \"appended_conversation\": {\n    \"conversation_id\": 7339181,\n    \"content\": \"**@Developers** we're extending the survey deadline to gather more feedback. Please fill it out soon!\",\n    \"creator_name\": \"Enric Enrich\"\n  }\n}\n\n### Example output\n{\n  \"type_primary\": \"informational\",\n  \"importance\": 4,\n  \"density\": 2,\n  \"summary\": \"A reminder from Enric extending the developer survey deadline and asking for more responses.\",\n  \"needs_response\": true,\n  \"response_hint\": \"Acknowledge and confirm participation or provide feedback on the survey.\"\n}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -1376,
        96
      ],
      "id": "4b70df0e-3a84-48ed-a2f7-ff3a53827e62",
      "name": "PAIST Conversation Summariser",
      "retryOnFail": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Process the following threads and return results in valid JSON only, one object per thread, preserving input order. Do not invent fields or content. Use the schema from the system prompt.\n\nUSER_CONTEXT:\n- now_iso: \"{{ $json.now ?? $now }}\"  // optional; helps density/recency if you use timestamps\n\nINPUT:\n\n{{ JSON.stringify($json) }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an intelligent personal assistant whose goal is to help the user stay organised, reduce noise, and focus on the most meaningful conversations.\n\nYou will read message threads, understand their intent, and produce a structured summary in **valid JSON** only ‚Äî no extra text.\n\n---\n\n### Process\n1. **Understand the conversation**\n   - Read all messages.\n   - Identify the main topic, purpose, and outcome.\n   - Note whether the user was mentioned or asked to act.\n\n2. **Classify the thread**\n   - Use one primary type:\n     [\"project\", \"informational\", \"request\", \"issue\", \"social\", \"other\"]\n\n3. **Score importance (0‚Äì5)**\n   - Base score:\n     request=3, issue=3, project=2, informational=1, social=0, other=1\n   - Add +2 if user is mentioned directly (cap 5)\n   - Add +1 if urgent, decision-critical, or blocking (cap 5)\n\n4. **Score density (0‚Äì5)**\n   - 0‚Äì2 = few/short/casual comments  \n   - 3‚Äì4 = moderate thread with substance  \n   - 5 = large, detailed, or decision-heavy thread\n\n5. **Summarise**\n   - One short, factual paragraph (‚â§ 60 words)\n   - Describe what happened, main topic, and any clear outcome.\n\n6. **Response logic**\n   - `needs_response` = true if:\n     - user is directly mentioned **and**\n       the comment implies a question, action, or unresolved decision.\n\n---\n\n### Output format\nReturn only JSON (no text before/after):\n{\n  \"type_primary\": \"string\",\n  \"importance\": 0,\n  \"density\": 0,\n  \"summary\": \"string\",\n  \"needs_response\": true,\n}\n\n---\n\n### Example input\n{\n  \"thread_id\": 7339181,\n  \"thread\": {\n    \"channel_id\": 1265,\n    \"thread_id\": 7339181,\n    \"content\": \"**@Developers** we're extending the survey deadline to gather more feedback. Please fill it out soon!\",\n    \"creator_name\": \"Enric Enrich\"\n  }\n}\n\n### Example output\n{\n  \"type_primary\": \"informational\",\n  \"importance\": 4,\n  \"density\": 2,\n  \"summary\": \"A reminder from Enric extending the developer survey deadline and asking for more responses.\",\n  \"needs_response\": true,\n}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -1376,
        320
      ],
      "id": "fdd02683-efe4-405a-9166-a964c127961f",
      "name": "PAIST Thread Summariser",
      "retryOnFail": true
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"type_primary\": \"informational\",\n  \"importance\": 4,\n  \"density\": 2,\n  \"summary\": \"A reminder from Enric extending the developer survey deadline and asking for more responses.\",\n  \"needs_response\": true\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -1232,
        576
      ],
      "id": "2bfcf521-b5c9-4af9-901c-ba6eb502dbf7",
      "name": "Thread Output Parser"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"type_primary\": \"informational\",\n  \"importance\": 4,\n  \"density\": 2,\n  \"summary\": \"A reminder from Enric extending the developer survey deadline and asking for more responses.\",\n  \"needs_response\": false\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -1072,
        576
      ],
      "id": "87ac1d83-4640-4fd6-9edf-cd85e24919b3",
      "name": "Conversation Output Parser"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d8a79ecb-8c78-4057-a49c-eecfe630c132",
              "name": "conversation_id",
              "value": "={{ $json.conversation_id }}",
              "type": "string"
            },
            {
              "id": "4d70f426-c61d-49f6-9b6f-1281472af10f",
              "name": "conversation",
              "value": "={{ $json.appended_conversation }}",
              "type": "array"
            },
            {
              "id": "7577ad4a-4e02-4657-8148-01d46bc8affd",
              "name": "conversation_url",
              "value": "={{ `https://twist.com/a/` + $('Variables').item.json.workspace_id + `/msg/` + $json.conversation_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1632,
        96
      ],
      "id": "bad5edd6-3afa-45a0-81b3-b13e9c133eaf",
      "name": "Set Conversation URL"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -1024,
        112
      ],
      "id": "941e1182-8c8f-4342-a57a-532500207094",
      "name": "Merge Summary and Conversation"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "comments",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -848,
        112
      ],
      "id": "b24467bb-5d52-4489-a5a1-4e57c8106d8d",
      "name": "Combine All Conversations"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f0e3d4fd-d340-4003-aac0-c6992380a16b",
              "name": "thread_id",
              "value": "={{ $json.thread_id }}",
              "type": "string"
            },
            {
              "id": "9ee55aa5-73f8-453b-b466-9ffa2f5c6141",
              "name": "thread",
              "value": "={{ $json.appended_thread }}",
              "type": "array"
            },
            {
              "id": "2403870b-9fc0-416f-8c53-bcd5b13c7372",
              "name": "thread_url",
              "value": "={{ `https://twist.com/a/` + $('Variables').item.json.workspace_id + `/ch/` + $json.appended_thread[0].channel_id + `/t/` + $json.thread_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1632,
        320
      ],
      "id": "e2f63482-fa7c-4f00-a50a-dda4adc0a489",
      "name": "Set Thread URL"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -1024,
        320
      ],
      "id": "f709ea98-6a30-4f7b-bb86-b7de2270486c",
      "name": "Merge Summary and Thread"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "threads",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -848,
        320
      ],
      "id": "96e16603-d6ac-4c6e-950c-da7961894bc4",
      "name": "Combine All Threads"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "numberInputs": 3,
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -576,
        112
      ],
      "id": "777fa4a5-7f7d-421d-b997-71a538bf740e",
      "name": "Merge Everything"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Variables').item.json.twist_api }}/conversation_messages/add",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "twistOAuth2Api",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "conversation_id",
              "value": "={{ $('Variables').item.json.conversation_id }}"
            },
            {
              "name": "content",
              "value": "={{ $json.output }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -48,
        128
      ],
      "id": "219efb5f-936d-458a-8585-f9834db95d00",
      "name": "HTTP Request",
      "credentials": {
        "twistOAuth2Api": {
          "id": "11",
          "name": "Twist account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.twist.com/api/v3/conversations/mark_unread",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "twistOAuth2Api",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "conversation_id",
              "value": "={{ $('Variables').item.json.conversation_id }}"
            },
            {
              "name": "message_id",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        176,
        128
      ],
      "id": "35fb426c-e636-424a-bd6a-ec7690596f5a",
      "name": "Mark as Unread",
      "credentials": {
        "twistOAuth2Api": {
          "id": "11",
          "name": "Twist account"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 10
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -3376,
        304
      ],
      "id": "c56c374a-8bb4-4aa1-8bf0-58576200a7ab",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "355160e0-a20e-4472-8d8c-2ebcd9c0ad06",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2704,
        320
      ],
      "id": "c9a342a1-99b5-4691-a293-1ababfb94f53",
      "name": "If Threads"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "8b1167c4-e6cb-49a2-9b45-666496f36211",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2704,
        96
      ],
      "id": "28d89e68-cfca-4a79-8ed0-7df17437afa7",
      "name": "If Conversations"
    },
    {
      "parameters": {
        "content": "## Variables\n\nSet your variables here. For where the post goes and your name",
        "height": 288,
        "width": 192
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3200,
        -48
      ],
      "typeVersion": 1,
      "id": "e5200823-36b0-4f60-9204-8cb24c6dfad8",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## Get stuff\n\nGets unread threads, conversations and Todoist tasks",
        "height": 816,
        "width": 160
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2960,
        -320
      ],
      "typeVersion": 1,
      "id": "29ab564d-a027-4338-8ac3-8958c4ed5ba5",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "## Get content\n\nGets the actual content",
        "height": 816,
        "width": 160
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2528,
        -320
      ],
      "typeVersion": 1,
      "id": "a893f5a7-3d85-4cd5-a63a-3349b8aaf46d",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "## Summarise\nReviews the content and gives a summary, type, density etc. Feel free to adjust the prompt for your needs",
        "height": 544,
        "width": 320
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1424,
        -48
      ],
      "typeVersion": 1,
      "id": "73bca667-687e-4691-87a0-28a76b810091",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "## PA\nTakes all the tasks, threads, conversations and summary and groups it all and suggests if a response is needed",
        "height": 528,
        "width": 304
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -416,
        -32
      ],
      "typeVersion": 1,
      "id": "a6069f78-efaa-4d2f-9e27-6b57d1da9478",
      "name": "Sticky Note"
    }
  ],
  "connections": {
    "When clicking ‚ÄòExecute workflow‚Äô": {
      "main": [
        [
          {
            "node": "Variables",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Unread Conversations": {
      "main": [
        [
          {
            "node": "If Conversations",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Variables": {
      "main": [
        [
          {
            "node": "Get Unread Conversations",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Unread threads",
            "type": "main",
            "index": 0
          },
          {
            "node": "Today's tasks",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Unread threads": {
      "main": [
        [
          {
            "node": "If Threads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Thread Comments": {
      "main": [
        [
          {
            "node": "Filter Deleted Threads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Group By Thread Id": {
      "main": [
        [
          {
            "node": "Set Thread URL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Store Thread": {
      "main": [
        [
          {
            "node": "Group By Thread Id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Today's tasks": {
      "main": [
        [
          {
            "node": "Combine all tasks",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get All Messages": {
      "main": [
        [
          {
            "node": "Filter: Deleted Messages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Group By Conversation Id": {
      "main": [
        [
          {
            "node": "Set Conversation URL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter: Deleted Messages": {
      "main": [
        [
          {
            "node": "Store Messages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini 2.5 Flash": {
      "ai_languageModel": [
        [
          {
            "node": "PAIST Thread Summariser",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "PAIST Conversation Summariser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "PAIST Planner",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Combine all tasks": {
      "main": [
        [
          {
            "node": "Merge Everything",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Store Messages": {
      "main": [
        [
          {
            "node": "Group By Conversation Id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Deleted Threads": {
      "main": [
        [
          {
            "node": "Store Thread",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PAIST Conversation Summariser": {
      "main": [
        [
          {
            "node": "Merge Summary and Conversation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PAIST Thread Summariser": {
      "main": [
        [
          {
            "node": "Merge Summary and Thread",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Thread Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "PAIST Thread Summariser",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Conversation Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "PAIST Conversation Summariser",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "PAIST Planner": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Conversation URL": {
      "main": [
        [
          {
            "node": "PAIST Conversation Summariser",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge Summary and Conversation",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge Summary and Conversation": {
      "main": [
        [
          {
            "node": "Combine All Conversations",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Combine All Conversations": {
      "main": [
        [
          {
            "node": "Merge Everything",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Set Thread URL": {
      "main": [
        [
          {
            "node": "PAIST Thread Summariser",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge Summary and Thread",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge Summary and Thread": {
      "main": [
        [
          {
            "node": "Combine All Threads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Combine All Threads": {
      "main": [
        [
          {
            "node": "Merge Everything",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Merge Everything": {
      "main": [
        [
          {
            "node": "PAIST Planner",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Mark as Unread",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Variables",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Threads": {
      "main": [
        [
          {
            "node": "Get Thread Comments",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge Everything",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "If Conversations": {
      "main": [
        [
          {
            "node": "Get All Messages",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge Everything",
            "type": "main",
            "index": 1
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": {
    "node:Schedule Trigger": {
      "recurrenceRules": []
    }
  },
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "4084938f-c70a-4b38-9a65-e13ae52e2dc8",
  "versionCounter": 17,
  "triggerCount": 1,
  "tags": [],
  "shared": [
    {
      "updatedAt": "2025-10-27T18:19:48.835Z",
      "createdAt": "2025-10-27T18:19:48.835Z",
      "role": "workflow:owner",
      "workflowId": "ekNtCLOwi49Vywr9",
      "projectId": "rteHPQr0gQHvUBnH",
      "project": {
        "updatedAt": "2024-06-07T07:01:15.292Z",
        "createdAt": "2024-06-07T07:01:15.292Z",
        "id": "rteHPQr0gQHvUBnH",
        "name": "Gon√ßalo Silva <goncalossilva@gmail.com>",
        "type": "personal",
        "icon": null,
        "description": null
      }
    }
  ]
}